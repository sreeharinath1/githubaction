name: Contexts-Demo

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        default: 'dev'

env:
  GLOBAL_VAR: "This is a global variable"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Print GitHub Context
        run: |
          echo "Repo: ${{ github.repository }}"
          echo "Actor: ${{ github.actor }}"
          echo "Branch Ref: ${{ github.ref }}"
          echo "Run ID: ${{ github.run_id }}"
          echo "Workspace: ${{ github.workspace }}"
          echo "Event Name: ${{ github.event_name }}"
          echo "Input Environment: ${{ inputs.environment }}"

      - name: Print Runner Context
        run: |
          echo "Runner OS: ${{ runner.os }}"
          echo "Runner Arch: ${{ runner.arch }}"
          echo "Runner Name: ${{ runner.name }}"
          echo "Runner Tool Cache: ${{ runner.tool_cache }}"
          echo "Runner Debug: ${{ runner.debug }}"

      - name: Print Job Context
        run: |
          echo "Job Status: ${{ job.status }}"

      - name: Use Env Context
        run: echo "Global Var: ${{ env.GLOBAL_VAR }}"

      - name: Step Output Example
        id: step1
        run: echo "result=42" >> $GITHUB_OUTPUT

      - name: Read Step Output
        run: echo "Step1 result: ${{ steps.step1.outputs.result }}"

      - name: Expression Functions Demo
        run: |
          echo "Contains check: ${{ contains(github.ref, 'main') }}"
          echo "StartsWith check: ${{ startsWith(github.ref, 'refs/tags/') }}"
          echo "EndsWith check: ${{ endsWith(github.actor, 'bot') }}"
          echo "Formatted string: ${{ format('Hello {0}', github.actor) }}"
          echo "Vars JSON: ${{ toJSON(vars) }}"
          echo "FromJSON parse: ${{ fromJSON('{\"key\":\"value\"}').key }}"

      - name: Debugging Contexts
        run: |
          echo "--- GITHUB ---"
          echo "${{ toJSON(github) }}"
          echo "--- VARS ---"
          echo "${{ toJSON(vars) }}"
          echo "--- RUNNER ---"
          echo "${{ toJSON(runner) }}"
          echo "--- JOB ---"
          echo "${{ toJSON(job) }}"
          echo "--- STEPS ---"
          echo "${{ toJSON(steps) }}"
